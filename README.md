## ion-java Benchmarking CLI

This tool allows users to...
1. Compare [ion-java](https://github.com/amzn/ion-java/) to Java implementations of other
serialization formats (not yet implemented)
2. Determine which ion-java configurations perform best

...for the individual users' data and access patterns.

Additionally, allows ion-java developers to...
1. Determine the impact of a proposed change
2. Decide where investments should be made in improving performance

...by generating results from a variety of real-world data and access patterns.

The tool uses the [JMH](https://openjdk.java.net/projects/code-tools/jmh/) microbenchmarking
library and produces results in formats generated by JMH.

The following stats will be included in benchmark results:

* Speed (or throughput)
* Heap usage
* Garbage collection statistics (number of GCs, total time taken, average size of various GC
generations)
* Size of the data (the input data for read benchmarks and the output data for write benchmarks)

## Installation

Building the tool generates a self-contained executable `jar`.

To build the tool with the latest version of the ion-java library, simply run

```
mvn clean install
```
from the directory containing `pom.xml`. When the build completes, a `jar` named
`ion-java-benchmark-cli-<version>-jar-with-dependencies.jar` will be present in the `target/`
subdirectory.

This `jar` may be copied to any location and may be executed using `java -jar <path-to-jar>`.
Users may find it convenient to create an alias to `java -jar <path-to-jar>` named, e.g.,
`ion-java-benchmark` to simplify invocation of the tool.

Note: the Maven build will look for the latest ion-java version available in the local Maven
repository. Users may use the tool with a custom or in-development ion-java version by installing
the desired version into the local Maven repository. To determine which ion-java version the tool
is using, use the `--version` command. After switching ion-java versions, the executable `jar`
must be rebuilt.

## Examples

(Note: these examples assume the invocation of the tool has been aliased to `ion-java-benchmark`.)

Benchmark a full-traversal read of `example.10n` from file using the IonReader API, with 10 warmups,
10 iterations, and 1 fork, printing the results to stdout in JMH’s standard text format.

```
ion-java-benchmark read example.10n
```

Benchmark a fully-buffered write of binary Ion data equivalent to `example.10n` to file using the
IonWriter API, with 10 warmups, 10 iterations, and 1 fork, printing the results to stdout in JMH’s
standard text format.

```
ion-java-benchmark write example.10n
```

Benchmark a write of binary Ion data equivalent to the first 1,000 top-level values in `example.10n`
to in-memory bytes using the IonWriter API, flushing after every 100 top-level values. Produce
results for both 0-byte length preallocation and 2-byte length preallocation to facilitate
comparison of both settings.

```
ion-java-benchmark write --io-type buffer \
                         --limit 1000 \
                         --ion-flush-period 100 \
                         --ion-length-preallocation 0 \
                         --ion-length-preallocation 2 \
                         example.10n
```

Profile a sparse read of `example.10n` from file, materializing only the values that match the paths
specified in paths.ion, using [ion-java-path-extraction](https://github.com/amzn/ion-java-path-extraction/).
This process will repetitively execute until manually terminated, allowing the user to attach a tool
for gathering performance profiles.

```
ion-java-benchmark read --profile --paths paths.ion example.10n
```

Benchmark a fully-buffered write of binary Ion data equivalent to `example.10n` both with and without
using shared symbol tables. The file `tables.ion` contains a sequence of Ion symbol tables, while the
file `empty.ion` is empty.

```
ion-java-benchmark write --ion-imports tables.ion --ion-imports empty.ion example.10n
```

Benchmark a full-traversal read of `example.10n`, producing results from using both the DOM and
IonReader APIs, using the sequence of symbol tables specified in `tables.ion` as the catalog from
which to resolve shared symbol table imports encountered in the input data.

```
ion-java-benchmark read --ion-imports tables.ion \
                        --ion-api dom \
                        --ion-api streaming \
                        example.10n
```

## Security

See [CONTRIBUTING](CONTRIBUTING.md#security-issue-notifications) for more information.

## License

This project is licensed under the Apache-2.0 License.

